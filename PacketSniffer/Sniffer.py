#!/usr/bin/env python3 

import logging, sys , os
from termcolor import colored
logging.getLogger("scapy.runtime").setLevel(logging.ERROR)

try:
   from scapy.all import *
except ImportError:
	print(colored('[-] Please install scapy!', 'red'))
	exit(-1)

os.system("clear")

def TCP(pkt):
   frame = """



                       ################################################
                                      \033[1;91m.:Ethernet Header:.\033[00m            

                        \033[1;94mSource Mac:\033[00m {srcmac}                   
                        \033[1;94mDestination Mac:\033[00m {dstmac}                   
                                                                     
                       ################################################
                                          \033[1;91m.:IP:.\033[00m                  

                        \033[1;94mDestination IP:\033[00m {dstip}                       
                        \033[1;94mSource IP:\033[00m {srcip}                       
                        \033[1;94mProtocol Number:\033[00m {proto} 
                        \033[1;94mIp Version:\033[00m {ipv}
                        \033[1;94mIHL:\033[00m {ihl}
                        \033[1;94mTOS:\033[00m {tos} 
                        \033[1;94mTotal Length:\033[00m {iplen}
                        \033[1;94mIdentification:\033[00m {ipid}    
                        \033[1;94mFlags:\033[00m {ipflags}   
                        \033[1;94mFragment Offset:\033[00m {ipfrag}  
                        \033[1;94mTime To Live:\033[00m {ttl} 
                        \033[1;94mHeader Checksum:\033[00m {hchksum}                         
                                                                     
                       ################################################
                                          \033[1;91m.:TCP:.\033[00m              

                        \033[1;94mDestination Port:\033[00m {dstport}                                     
                        \033[1;94mSource Port:\033[00m {srcport}                                    
                        \033[1;94mSequence Num:\033[00m {seqnum}                                      
                        \033[1;94mAcknowledgement Num:\033[00m {acknum}                                      
                        \033[1;94mData Offset:\033[00m {dataoff}                                  
                        \033[1;94mReserved:\033[00m {reservd}                                     
                        \033[1;94mFlags:\033[00m {flags}                                        
                        \033[1;94mWindow Size:\033[00m {winsize}                                     
                        \033[1;94mChecksum:\033[00m {chksum}                                       
                        \033[1;94mUrgent Pointer:\033[00m {urgpoit}                                
                                                                     
                       ################################################

      
      """

   pktdetails = {'srcmac': pkt.src, 
                 'dstmac': pkt.dst, 
                 'dstip': ip.dst, 
                 'srcip': ip.src, 
                 'proto': ip.proto,
                 'ipv': ip.version,
                 'ihl': ip.ihl, 
                 'tos': ip.tos,
                 'iplen': ip.len,
                 'ipid': ip.id,
                 'ipflags': ip.flags,
                 'ipfrag': ip.frag,
                 'ttl': ip.ttl,
                 'hchksum': ip.chksum, 
                 'dstport': pkt.dport,
                 'srcport': pkt.sport,
                 'seqnum': pkt.seq,
                 'acknum': pkt.ack,
                 'dataoff': pkt.dataofs,
                 'reservd': pkt.reserved,
                 'flags': pkt.flags,
                 'winsize': pkt.window,
                 'chksum': pkt.chksum,
                 'urgpoit': pkt.urgptr
             }

   print(frame.format(**pktdetails))
   print(" ")
   print(" ")
   hexdump(pkt)

def ICMP(pkt):
   frame = """



                       ################################################
                                      \033[1;91m.:Ethernet Header:.\033[00m            

                        \033[1;94mSource Mac:\033[00m {srcmac}                   
                        \033[1;94mDestination Mac:\033[00m {dstmac}                   
                                                                     
                       ################################################
                                          \033[1;91m.:IP:.\033[00m                  

                        \033[1;94mDestination IP:\033[00m {dstip}                       
                        \033[1;94mSource IP:\033[00m {srcip}                       
                        \033[1;94mProtocol Number:\033[00m {proto}
                        \033[1;94mIp Version:\033[00m {ipv}
                        \033[1;94mIHL:\033[00m {ihl}
                        \033[1;94mTOS:\033[00m {tos} 
                        \033[1;94mTotal Length:\033[00m {iplen}
                        \033[1;94mIdentification:\033[00m {ipid}    
                        \033[1;94mFlags:\033[00m {ipflags}   
                        \033[1;94mFragment Offset:\033[00m {ipfrag}  
                        \033[1;94mTime To Live:\033[00m {ttl} 
                        \033[1;94mHeader Checksum:\033[00m {hchksum}                          
                                                                     
                       ################################################
                                          \033[1;91m.:ICMP:.\033[00m              

                        \033[1;94mType of Message:\033[00m {dstport}                                     
                        \033[1;94mCode:\033[00m {srcport}                                    
                        \033[1;94mChecksum:\033[00m {seqnum}                                      
                        \033[1;94mIdentifier:\033[00m {acknum}                                      
                        \033[1;94mSequence Number:\033[00m {dataoff}                                  
                        \033[1;94mTs Origin:\033[00m {reservd}                                     
                        \033[1;94mTs Tx:\033[00m {flags}                                        
                        \033[1;94mGateway:\033[00m {winsize}                                     
                        \033[1;94mPtr:\033[00m {chksum}                                       
                        \033[1;94mUrgent Pointer:\033[00m {urgpoit} 
                        \033[1;94mAddress Mask:\033[00m {addrmask} 
                        \033[1;94mUnused:\033[00m {unused}                                   
                                                                     
                       ################################################

      
      """

   pktdetails = {'srcmac': pkt.src, 
                 'dstmac': pkt.dst, 
                 'dstip': ip.dst, 
                 'srcip': ip.src, 
                 'proto': ip.proto,
                 'ipv': ip.version,
                 'ihl': ip.ihl, 
                 'tos': ip.tos,
                 'iplen': ip.len,
                 'ipid': ip.id,
                 'ipflags': ip.flags,
                 'ipfrag': ip.frag,
                 'ttl': ip.ttl,
                 'hchksum': ip.chksum, 
                 'dstport': pkt.type,
                 'srcport': pkt.code,
                 'seqnum': pkt.chksum,
                 'acknum': pkt.id,
                 'dataoff': pkt.seq,
                 'reservd': pkt.ts_ori,
                 'flags': pkt.ts_rx,
                 'winsize': pkt.gw,
                 'chksum': pkt.ptr,
                 'urgpoit': pkt.reserved,
                 'addrmask': pkt.addr_mask,
                 'unused': pkt.unused
             }

   print(frame.format(**pktdetails))
   print(" ")
   print(" ")
   hexdump(pkt)

def UDP(pkt):
   frame = """



                       ################################################
                                      \033[1;91m.:Ethernet Header:.\033[00m            

                        \033[1;94mSource Mac:\033[00m {srcmac}                   
                        \033[1;94mDestination Mac:\033[00m {dstmac}                   
                                                                     
                       ################################################
                                          \033[1;91m.:IP:.\033[00m                  

                        \033[1;94mDestination IP:\033[00m {dstip}                       
                        \033[1;94mSource IP:\033[00m {srcip}                       
                        \033[1;94mProtocol Number:\033[00m {proto}
                        \033[1;94mIp Version:\033[00m {ipv}
                        \033[1;94mIHL:\033[00m {ihl}
                        \033[1;94mTOS:\033[00m {tos} 
                        \033[1;94mTotal Length:\033[00m {iplen}
                        \033[1;94mIdentification:\033[00m {ipid}    
                        \033[1;94mFlags:\033[00m {ipflags}   
                        \033[1;94mFragment Offset:\033[00m {ipfrag}  
                        \033[1;94mTime To Live:\033[00m {ttl} 
                        \033[1;94mHeader Checksum:\033[00m {hchksum}            
                                                                     
                       ################################################
                                          \033[1;91m.:UDP:.\033[00m              

                        \033[1;94mSource Port:\033[00m {srcport}                                     
                        \033[1;94mDestination Port:\033[00m {dstport}                                    
                        \033[1;94mLength:\033[00m {Length}                                      
                        \033[1;94mChecksum:\033[00m {chksum}                                                             
                                                                     
                       ################################################

      
      """
   pktdetails = {'srcmac': pkt.src, 
                 'dstmac': pkt.dst, 
                 'dstip': ip.dst, 
                 'srcip': ip.src,
                 'proto': ip.proto,
                 'ipv': ip.version,
                 'ihl': ip.ihl, 
                 'tos': ip.tos,
                 'iplen': ip.len,
                 'ipid': ip.id,
                 'ipflags': ip.flags,
                 'ipfrag': ip.frag,
                 'ttl': ip.ttl,
                 'hchksum': ip.chksum,
                 'srcport': pkt.sport,
                 'dstport': pkt.dport,
                 'Length': pkt.len,
                 'chksum': pkt.chksum,
                }

   print(frame.format(**pktdetails))
   print(" ")
   print(" ")
   hexdump(pkt)
   exit(0)

def pkthandler(pkt):
   if pkt.haslayer(IP):
      global ip
      ip = pkt[IP]
      dstip = ip.dst
      srcip = ip.src

      if ip.proto == 6: TCP(pkt)
      elif ip.proto == 1: ICMP(pkt)
      elif ip.proto == 17: UDP(pkt)
   
pkt = sniff(prn=pkthandler)